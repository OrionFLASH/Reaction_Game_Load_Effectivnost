# Программа обработки данных из Excel файлов

## Описание

Программа предназначена для автоматической обработки данных из Excel файлов с последующим выводом результатов в форматах CSV и Excel. Программа включает в себя систему логирования, обработку ошибок, детальную статистику выполнения и возможность создания тестовых данных.

## Техническое задание

### Основные требования:
- Использование базовых библиотек из Anaconda
- Запуск в отдельном окружении
- Обработка данных из двух Excel файлов
- Вывод результатов в два формата: CSV (с разделителем ";") и Excel
- Система логирования с двумя уровнями: INFO и DEBUG
- Автоматическое создание рабочей структуры папок
- Временные метки в именах файлов
- Детальная статистика выполнения
- **НОВОЕ**: Создание тестовых данных для демонстрации

### Структура рабочей папки:
```
WORK/
├── INPUT/          # Входные Excel файлы
├── OUTPUT/         # Выходные файлы (CSV и Excel)
└── LOGS/           # Лог-файлы
```

## Функциональность

### 1. Загрузка данных
- Автоматическое обнаружение и загрузка Excel файлов из папки INPUT
- Поддержка форматов .xlsx и .xls
- Обработка ошибок при загрузке файлов

### 2. Обработка данных
- Объединение данных из нескольких файлов
- Удаление дубликатов
- Обработка пропущенных значений (замена на "N/A")
- Сортировка данных по первому столбцу

### 3. Вывод результатов
- Сохранение в CSV формат с разделителем ";"
- Сохранение в Excel формат (.xlsx)
- Автоматическое именование файлов с временными метками

### 4. Система логирования
- Два уровня логирования: INFO и DEBUG
- Автоматическое создание лог-файлов с временными метками
- Логирование в файл и консоль
- Детальная информация о времени выполнения

### 5. Создание тестовых данных (НОВОЕ)
- Автоматическая генерация Excel файлов с примерными данными
- Создание структуры папок
- Демонстрация работы программы
- Логирование процесса создания

## Установка и настройка

### Требования
- Python 3.7+
- Anaconda или Miniconda
- Библиотеки: pandas, openpyxl, numpy

### Установка зависимостей
```bash
conda install pandas openpyxl numpy
```

### Настройка окружения
1. Создайте новое conda окружение:
```bash
conda create -n data_processor python=3.9
conda activate data_processor
```

2. Установите необходимые пакеты:
```bash
conda install pandas openpyxl numpy
```

## Конфигурация

### Основные настройки (в начале файла main.py):

```python
# Рабочая директория
WORK_DIR = r"/Users/orionflash/Desktop/MyProject/Reaction_Effectiv_LOAD/WORK"

# Входные файлы
INPUT_FILES = [
    {"name": "data1", "extension": ".xlsx"},
    {"name": "data2", "extension": ".xlsx"}
]

# Выходные файлы
OUTPUT_FILES = [
    {"name": "processed_data", "extension": ".csv", "suffix_format": "_YYYYMMDD-HHMMSS"},
    {"name": "processed_data", "extension": ".xlsx", "suffix_format": "_YYYYMMDD-HHMMSS"}
]

# Режим работы программы
# "process" - обработка данных (основная работа)
# "create-test" - создание тестовых данных
PROGRAM_MODE = "process"

# Уровень логирования
LOG_LEVEL = "INFO"  # или "DEBUG"
```

## Использование

### Режимы работы программы:

#### 1. Создание тестовых данных
```python
# В файле main.py измените переменную:
PROGRAM_MODE = "create-test"
```

Затем запустите:
```bash
# Активируйте окружение
conda activate data_processor

# Создайте тестовые Excel файлы
python main.py
```

#### 2. Обработка данных (основная работа)
```python
# В файле main.py установите переменную:
PROGRAM_MODE = "process"
```

Затем запустите:
```bash
# Активируйте окружение
conda activate data_processor

# Запустите обработку данных
python main.py
```

#### 3. Изменение уровня логирования
```python
# В файле main.py измените переменную:
LOG_LEVEL = "DEBUG"  # или "INFO"
```

### Пошаговый процесс:

1. **Настройка режима работы**:
   - Откройте файл `main.py`
   - Измените переменную `PROGRAM_MODE`:
     - `"create-test"` - для создания тестовых данных
     - `"process"` - для обработки данных (основная работа)

2. **Подготовка данных**:
   - Поместите входные Excel файлы в папку `WORK/INPUT/`
   - Или создайте тестовые данные, установив `PROGRAM_MODE = "create-test"`

3. **Запуск программы**:
   - Выполните `python main.py`
   - Результаты сохраняются в папку `WORK/OUTPUT/`
   - Логи сохраняются в папку `WORK/LOGS/`

4. **Проверка результатов**:
   - **Входные файлы**: `WORK/INPUT/`
   - **Результаты**: `WORK/OUTPUT/`
   - **Логи**: `WORK/LOGS/`

## Структура кода

### Основные классы:

#### DataProcessorLogger
- Управление системой логирования
- Создание лог-файлов с временными метками
- Настройка уровней логирования (INFO/DEBUG)

#### TestDataGenerator (НОВЫЙ)
- Создание тестовых Excel файлов
- Генерация примерных данных
- Логирование процесса создания
- Статистика выполнения

#### DataProcessor
- Основная логика обработки данных
- Загрузка Excel файлов
- Обработка и объединение данных
- Сохранение результатов
- Генерация статистики выполнения

### Ключевые методы:

#### TestDataGenerator.create_sample_data()
- Создает два Excel файла с тестовыми данными
- Генерирует случайные данные для демонстрации
- Логирует процесс создания

#### DataProcessor.load_excel_files()
- Загружает данные из Excel файлов
- Обрабатывает ошибки загрузки
- Возвращает список DataFrame'ов

#### DataProcessor.process_data()
- Объединяет данные из нескольких файлов
- Удаляет дубликаты
- Обрабатывает пропущенные значения
- Сортирует данные

#### DataProcessor.save_outputs()
- Сохраняет результаты в CSV и Excel форматах
- Автоматически генерирует имена файлов
- Обрабатывает ошибки сохранения

#### DataProcessor.generate_summary()
- Создает сводку выполнения
- Время выполнения
- Количество обработанных файлов
- Количество ошибок

## Логирование

### Уровни логирования:
- **INFO**: Основная информация о ходе выполнения
- **DEBUG**: Детальная информация для отладки

### Формат лог-файлов:
- Имя: `processing_log-{LEVEL}_{YYYYMMDD}.log`
- Кодировка: UTF-8
- Формат: `YYYY-MM-DD HH:MM:SS - LEVEL - MESSAGE`

### Примеры логов:
```
2024-01-15 10:30:15 - INFO - Программа запущена
2024-01-15 10:30:16 - INFO - Режим: Создание тестовых данных
2024-01-15 10:30:17 - INFO - Создан тестовый файл: data1.xlsx
2024-01-15 10:30:18 - INFO - Тестовые данные созданы успешно
2024-01-15 10:30:19 - INFO - Время выполнения: 0.45 секунд
```

## Обработка ошибок

### Типы обрабатываемых ошибок:
- Файл не найден
- Ошибки чтения Excel файлов
- Ошибки обработки данных
- Ошибки сохранения файлов
- Критические ошибки выполнения
- Ошибки создания тестовых данных

### Стратегия обработки:
- Логирование всех ошибок
- Продолжение работы при некритических ошибках
- Детальная информация об ошибках в DEBUG режиме
- Подсчет количества ошибок в сводке

## Производительность

### Оптимизации:
- Использование pandas для эффективной обработки данных
- Минимальное количество операций ввода-вывода
- Эффективное объединение DataFrame'ов

### Мониторинг:
- Время выполнения в секундах
- Количество обработанных строк
- Статистика по дубликатам и пропущенным значениям
- Количество созданных тестовых файлов

## Примеры использования

### Базовый сценарий:
1. Создайте тестовые данные: установите `PROGRAM_MODE = "create-test"` и запустите `python main.py`
2. Запустите обработку: установите `PROGRAM_MODE = "process"` и запустите `python main.py`
3. Получите результаты в папке OUTPUT

### Настройка для других файлов:
```python
INPUT_FILES = [
    {"name": "sales_data", "extension": ".xlsx"},
    {"name": "customer_data", "extension": ".xls"}
]
```

### Изменение формата выходных файлов:
```python
OUTPUT_FILES = [
    {"name": "final_report", "extension": ".csv", "suffix_format": "_YYYYMMDD"},
    {"name": "final_report", "extension": ".xlsx", "suffix_format": "_YYYYMMDD"}
]
```

### Создание тестовых данных с DEBUG логированием:
```python
# В файле main.py установите:
PROGRAM_MODE = "create-test"
LOG_LEVEL = "DEBUG"
```

## История версий

### Версия 1.0.0 (2024-01-15)
- Первоначальная версия программы
- Базовая функциональность обработки Excel файлов
- Система логирования с двумя уровнями
- Автоматическое создание структуры папок
- Обработка ошибок и статистика выполнения
- **НОВОЕ**: Создание тестовых данных
- **НОВОЕ**: Переменная PROGRAM_MODE для выбора режима работы
- **НОВОЕ**: Единый файл main.py

## Планы развития

### Версия 1.1.0 (планируется)
- Добавление поддержки других форматов файлов
- Конфигурационные файлы для настроек
- Веб-интерфейс для мониторинга
- Расширенные алгоритмы обработки данных

### Версия 1.2.0 (планируется)
- Параллельная обработка больших файлов
- Интеграция с базами данных
- API для внешних систем
- Расширенная аналитика данных

## Поддержка

### Документация:
- Подробные комментарии в коде на русском языке
- README файл с описанием функциональности
- Примеры конфигурации и использования

### Отладка:
- DEBUG режим логирования для детального анализа
- Обработка и логирование всех ошибок
- Статистика выполнения для мониторинга
- Создание тестовых данных для демонстрации

## Заключение

Программа предоставляет надежное решение для автоматической обработки данных из Excel файлов с возможностью настройки под различные требования. Система логирования и обработки ошибок обеспечивает стабильную работу в производственной среде. 

**Новая функциональность создания тестовых данных** позволяет быстро подготовить демонстрационные файлы и протестировать работу программы без необходимости подготовки реальных данных.

### 🚀 Готово к использованию:
- Все функции объединены в один файл main.py
- Создание тестовых данных и обработка данных
- Система логирования и обработки ошибок
- Автоматизация настройки и запуска
- Подробная документация на русском языке
